#!/bin/bash 

#MAGENTO_ROOT=${0%/vendor/*}
# ABsolute path script
SCRIPT_PATH="$(realpath "$0")"
# Get root path delete everything after vendor
MAGENTO_ROOT="${SCRIPT_PATH%/vendor/*}"

echo "Magento root: $MAGENTO_ROOT"
###############################
# Remove src directory if it already exist
###############################
rm -rf ${MAGENTO_ROOT}/src/ || true
rm -rf ${MAGENTO_ROOT}/bin/getProjectPathFromUrl.sh || true
rm -rf ${MAGENTO_ROOT}/docker || true
###############################
# Copy all content in src/
###############################
# Enable copy hidden files
shopt -s dotglob nullglob extglob

# Create config directories
mkdir ${MAGENTO_ROOT}/src 

# Trova tutto a depth 1 tranne src e .git, e sposta correttamente (gestisce spazi)
cd ${MAGENTO_ROOT}
find . -maxdepth 1 -mindepth 1 ! -name 'src' ! -name '.git' -print0 \
  | xargs -0 -I{} mv -- {} src/

# Copy docker/
cp -R ${MAGENTO_ROOT}/src/vendor/magefleet/magento2-cloud-build/dist/docker ${MAGENTO_ROOT}
# Copy bin/
cp -R ${MAGENTO_ROOT}/src/vendor/magefleet/magento2-cloud-build/dist/bin ${MAGENTO_ROOT}

